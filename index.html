<!DOCTYPE html>
<html>
<head>
  <title>FabricJS Workspace</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.2.4/fabric.min.js"></script>
  <style>
    #canvas-container {
      width: 800px;
      height: 600px;
      border: 1px solid #ccc;
      position: relative;
      overflow: hidden;
    }

    #canvas {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="canvas-container">
    <canvas id="canvas"></canvas>
  </div>

  <script>
    var canvas = new fabric.Canvas('canvas', {
      width: 2000,
      height: 1500,
      selection: true, // Make sure selection is enabled
      backgroundColor: '#f0f0f0',
      viewportTransform: [1, 0, 0, 1, 0, 0]
    });

    var container = document.getElementById('canvas-container');
    var containerWidth = container.offsetWidth;
    var containerHeight = container.offsetHeight;

    canvas.setDimensions({ width: containerWidth, height: containerHeight });

    // Zoom and pan functionality
    var isDragging = false;
    var previousMousePosition = {
      x: 0,
      y: 0
    };

    canvas.on('mouse:down', function(event) {
      if (event.e.altKey) { // Check if the Alt key is pressed for panning
        isDragging = true;
        previousMousePosition = {
          x: event.e.clientX,
          y: event.e.clientY
        };
      } else { // Otherwise, create a circle at the click position
        var pointer = canvas.getPointer(event.e);
        var circle = new fabric.Circle({
          left: pointer.x,
          top: pointer.y,
          radius: 20,
          fill: 'blue',
          originX: 'center',
          originY: 'center'
        });
        canvas.add(circle);
      }
    });

    canvas.on('mouse:move', function(event) {
      if (isDragging) {
        var deltaMove = {
          x: event.e.clientX - previousMousePosition.x,
          y: event.e.clientY - previousMousePosition.y
        };

        previousMousePosition = {
          x: event.e.clientX,
          y: event.e.clientY
        };

        canvas.relativePan(new fabric.Point(deltaMove.x, deltaMove.y));
      }
    });

    canvas.on('mouse:up', function() {
      isDragging = false;
    });

    canvas.on('mouse:wheel', function(event) {
      var delta = event.e.deltaY;
      var zoom = canvas.getZoom();
      zoom *= 0.999 ** delta;
      if (zoom > 0.1) {
        canvas.setZoom(zoom);
      }
      event.e.preventDefault();
      event.e.stopPropagation();
    });

    // Ensure the canvas is redrawn when the window is resized
    window.addEventListener('resize', function() {
      var containerWidth = container.offsetWidth;
      var containerHeight = container.offsetHeight;
      canvas.setDimensions({ width: containerWidth, height: containerHeight });
    });
  </script>
</body>
</html>
